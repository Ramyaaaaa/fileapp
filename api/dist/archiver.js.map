{"version":3,"sources":["../src/archiver.js"],"names":["FileArchiver","app","files","response","uploadDir","get","zip","s3Downloader","S3","attachment","pipe","_","each","file","fileObject","getFileObject","append","name","finalize"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;IACqBA,Y;AACjB,0BAAYC,GAAZ,EAAoC;AAAA,YAApBC,KAAoB,uEAAZ,EAAY;AAAA,YAATC,QAAS;;AAAA;;AAChC,aAAKF,GAAL,GAAWA,GAAX;AACA,aAAKC,KAAL,GAAaA,KAAb;AACA,aAAKC,QAAL,GAAgBA,QAAhB;AACH;;;;mCAES;;AAEN,gBAAMF,MAAM,KAAKA,GAAjB;AACA,gBAAMG,YAAYH,IAAII,GAAJ,CAAQ,YAAR,CAAlB;AACA,gBAAMH,QAAQ,KAAKA,KAAnB;AACA,gBAAMI,MAAM,wBAAS,KAAT,CAAZ;AACA,gBAAMH,WAAW,KAAKA,QAAtB;;AAEA,gBAAMI,eAAe,IAAIC,WAAJ,CAAOP,GAAP,EAAWE,QAAX,CAArB;;AAGAA,qBAASM,UAAT,CAAoB,cAApB;AACAH,gBAAII,IAAJ,CAASP,QAAT;AACAQ,6BAAEC,IAAF,CAAOV,KAAP,EAAa,UAACW,IAAD,EAAQ;;AAGjB,oBAAMC,aAAaP,aAAaQ,aAAb,CAA2BF,IAA3B,CAAnB;AACAP,oBAAIU,MAAJ,CAAWF,UAAX,EAAsB,EAACG,MAAKN,iBAAEN,GAAF,CAAMQ,IAAN,EAAW,cAAX,CAAN,EAAtB;;AAEA;AACA;AACH,aARD;;AAUAP,gBAAIY,QAAJ;;AAEA,mBAAQ,IAAR;AACH;;;;;;kBAjCgBlB,Y","file":"archiver.js","sourcesContent":["import archiver from 'archiver'\r\nimport _ from 'lodash'\r\nimport path from 'path'\r\nimport S3 from './s3'\r\nexport default class FileArchiver {\r\n    constructor(app,files = [],response){\r\n        this.app = app;\r\n        this.files = files;\r\n        this.response = response\r\n    }\r\n\r\n    download(){\r\n\r\n        const app = this.app;\r\n        const uploadDir = app.get('storageDir');\r\n        const files = this.files;\r\n        const zip = archiver('zip')\r\n        const response = this.response\r\n\r\n        const s3Downloader = new S3(app,response);\r\n\r\n        \r\n        response.attachment('download.zip');\r\n        zip.pipe(response);\r\n        _.each(files,(file)=>{\r\n            \r\n\r\n            const fileObject = s3Downloader.getFileObject(file);\r\n            zip.append(fileObject,{name:_.get(file,'originalName')})\r\n\r\n            // const filePath = path.join(uploadDir,_.get(file,'name'));\r\n            // zip.file(filePath,{name:_.get(file,'originalName')})\r\n        })\r\n\r\n        zip.finalize();\r\n\r\n        return  this;\r\n    }\r\n}"]}